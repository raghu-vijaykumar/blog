<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Decorator Pattern | Raghu Vijaykumar</title>
<meta name=keywords content="system-design,software-architecture,patterns,decorator"><meta name=description content="The Decorator Pattern is a structural design pattern used to add additional behaviors or responsibilities to objects dynamically. Unlike subclassing, where additional functionality is achieved through inheritance, the decorator pattern allows the augmentation of an object’s behavior without modifying its structure or the need for inheritance. This promotes adherence to the Open/Closed Principle and Single Responsibility Principle in software design.
Motivation The main motivation for using the decorator pattern is to add features or functionality to existing objects in a flexible and reusable way."><meta name=author content="Me"><link rel=canonical href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/decorator/readme/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.e7c811b1152f0ea0017b0724f2c040700cf8bf84343fd4fd5eca45af82337db9.css integrity="sha256-58gRsRUvDqABewck8sBAcAz4v4Q0P9T9XspFr4Izfbk=" rel="preload stylesheet" as=style><link rel=icon href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/decorator/readme/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Decorator Pattern"><meta property="og:description" content="The Decorator Pattern is a structural design pattern used to add additional behaviors or responsibilities to objects dynamically. Unlike subclassing, where additional functionality is achieved through inheritance, the decorator pattern allows the augmentation of an object’s behavior without modifying its structure or the need for inheritance. This promotes adherence to the Open/Closed Principle and Single Responsibility Principle in software design.
Motivation The main motivation for using the decorator pattern is to add features or functionality to existing objects in a flexible and reusable way."><meta property="og:type" content="article"><meta property="og:url" content="https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/decorator/readme/"><meta property="og:image" content="https://raghu-vijaykumar.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-08-26T00:01:00+05:30"><meta property="article:modified_time" content="2024-08-26T00:01:00+05:30"><meta property="og:site_name" content="Raghu Vijaykumar"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://raghu-vijaykumar.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Decorator Pattern"><meta name=twitter:description content="The Decorator Pattern is a structural design pattern used to add additional behaviors or responsibilities to objects dynamically. Unlike subclassing, where additional functionality is achieved through inheritance, the decorator pattern allows the augmentation of an object’s behavior without modifying its structure or the need for inheritance. This promotes adherence to the Open/Closed Principle and Single Responsibility Principle in software design.
Motivation The main motivation for using the decorator pattern is to add features or functionality to existing objects in a flexible and reusable way."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Docs","item":"https://raghu-vijaykumar.github.io/blog/docs/"},{"@type":"ListItem","position":2,"name":"Decorator Pattern","item":"https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/decorator/readme/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Decorator Pattern","name":"Decorator Pattern","description":"The Decorator Pattern is a structural design pattern used to add additional behaviors or responsibilities to objects dynamically. Unlike subclassing, where additional functionality is achieved through inheritance, the decorator pattern allows the augmentation of an object’s behavior without modifying its structure or the need for inheritance. This promotes adherence to the Open/Closed Principle and Single Responsibility Principle in software design.\nMotivation The main motivation for using the decorator pattern is to add features or functionality to existing objects in a flexible and reusable way.","keywords":["system-design","software-architecture","patterns","decorator"],"articleBody":"The Decorator Pattern is a structural design pattern used to add additional behaviors or responsibilities to objects dynamically. Unlike subclassing, where additional functionality is achieved through inheritance, the decorator pattern allows the augmentation of an object’s behavior without modifying its structure or the need for inheritance. This promotes adherence to the Open/Closed Principle and Single Responsibility Principle in software design.\nMotivation The main motivation for using the decorator pattern is to add features or functionality to existing objects in a flexible and reusable way. Instead of altering the original object or creating numerous subclasses for every possible combination of features, decorators allow you to “wrap” an object with new functionality dynamically.\nImplementation General Approach\nInheritance: One way to augment a class is by inheriting from it and adding new features. However, this approach can become cumbersome if multiple combinations of features are needed, leading to an explosion of subclasses. Decorators: A more flexible approach is to use decorators, which are objects that wrap the original object and add new behaviors to it. Decorators can be stacked, allowing for dynamic and combinatorial behavior modification. Python-Specific Implementation In Python, the decorator pattern can be implemented using higher-order functions, where a function wraps another function to extend its behavior. Python also provides special syntax for applying decorators to functions, using the @decorator_name syntax.\nimport time def time_it(func): def wrapper(): start = time.time() # Measure start time result = func() # Call the original function end = time.time() # Measure end time print(f'{func.__name__} took {int((end-start)*1000)}ms') # Print execution time return result return wrapper @time_it # Applying the time_it decorator def some_op(): print('Starting op') time.sleep(1) # Simulate a time-consuming operation print('We are done') return 123 if __name__ == '__main__': some_op() Explanation Decorator Function (time_it):\nPurpose: Measures the execution time of the function it decorates. How It Works: It defines an inner function (wrapper) that wraps the original function. The wrapper function records the start time, executes the original function, records the end time, and then prints the time taken to execute the function. Finally, it returns the result of the original function. Decorated Function (some_op):\nA simple function that simulates a time-consuming operation using time.sleep(1). The @time_it decorator is applied to this function, meaning that every time some_op is called, it will be wrapped in the timing logic defined in time_it. Execution:\nWhen some_op is called, the execution time is measured and printed due to the decorator, illustrating how the decorator pattern can be used to augment behavior without modifying the original function. Key Points Flexible Augmentation: Decorators allow the addition of functionality in a flexible manner without altering the original object or function. Reusability: Decorators can be reused across different functions or objects, promoting code reusability. Adherence to Design Principles: The decorator pattern supports the Open/Closed Principle by allowing the extension of an object’s behavior without modifying its code. Classic Implementation of Decorator Pattern in Object-Oriented Programming The Decorator Pattern is a structural design pattern used to dynamically add behavior to individual objects without affecting the behavior of other objects from the same class. This is achieved by creating decorator classes that wrap the original class, augmenting its functionality. This approach adheres to the Open/Closed Principle by allowing functionality to be extended without modifying existing code.\nMotivation In object-oriented programming, there often arises a need to extend the functionality of a class without modifying its code. Traditional inheritance can lead to an explosion of subclasses for every combination of features, making the system complex and hard to maintain. The decorator pattern offers a more flexible and reusable solution by allowing the dynamic composition of behaviors.\nImplementation Core Components Abstract Base Class (Shape):\nThe abstract base class provides a common interface for all shapes, ensuring that concrete classes and decorators can be treated uniformly. Concrete Classes (Circle, Square): These classes represent the basic shapes. They implement the core functionality, such as resizing or defining specific properties like radius or side length. Decorator Classes (ColoredShape, TransparentShape): These classes are decorators that add additional functionality, such as color or transparency, to the basic shapes. They wrap a shape object and extend its behavior. from abc import ABC class Shape(ABC): def __str__(self): return '' class Circle(Shape): def __init__(self, radius=0.0): self.radius = radius def resize(self, factor): self.radius *= factor def __str__(self): return f'A circle of radius {self.radius}' class Square(Shape): def __init__(self, side): self.side = side def __str__(self): return f'A square with side {self.side}' class ColoredShape(Shape): def __init__(self, shape, color): if isinstance(shape, ColoredShape): raise Exception('Cannot apply ColoredDecorator twice') self.shape = shape self.color = color def __str__(self): return f'{self.shape} has the color {self.color}' class TransparentShape(Shape): def __init__(self, shape, transparency): self.shape = shape self.transparency = transparency def __str__(self): return f'{self.shape} has {self.transparency * 100.0}% transparency' if __name__ == '__main__': circle = Circle(2) print(circle) red_circle = ColoredShape(circle, \"red\") print(red_circle) red_half_transparent_square = TransparentShape(red_circle, 0.5) print(red_half_transparent_square) # Example of double decoration mixed = ColoredShape(ColoredShape(Circle(3), 'red'), 'blue') print(mixed) Explanation Abstract Base Class (Shape):\nProvides a base class for all shapes, enforcing a uniform interface. In this case, it only defines a str method, which is overridden by concrete shapes and decorators. Concrete Shapes (Circle, Square): These classes inherit from Shape and provide specific implementations for geometric shapes.\nCircle: Implements radius-related functionality and includes a resize method.\nSquare: Represents a square and stores the length of its side. Decorator Classes (ColoredShape, TransparentShape):\nColoredShape: Adds color to a shape. It checks if the shape has already been colored to prevent applying the same decorator twice.\nTransparentShape: Adds transparency to a shape and converts the transparency value into a percentage for display.\nCombining Decorators:\nDecorators can be stacked, allowing for multiple extensions of the original shape’s functionality. For example, a circle can be both colored and transparent. The code demonstrates how to combine these decorators to create complex shapes with multiple features.\nKey Points Dynamic Behavior Extension: The decorator pattern allows you to dynamically add functionality to objects at runtime, promoting flexibility and reusability. Adherence to Design Principles: The pattern adheres to the Open/Closed Principle by allowing objects to be extended without modifying their code. Preventing Redundant Decoration: The implementation includes checks to prevent the same decorator from being applied multiple times, avoiding redundant or conflicting behaviors. Limitations Access to Original Methods: Decorators do not automatically provide access to the original object’s methods unless explicitly programmed. For example, the resize method of Circle is not accessible once the shape is decorated. Complexity: When multiple decorators are stacked, it can become difficult to manage the interactions between them, particularly if they modify the same aspect of the object. File Decorator Implementation with Logging This documentation outlines the implementation of a class decorator that wraps around a file object, allowing additional functionality such as logging while maintaining access to the file’s original methods. The approach leverages dynamic programming to proxy all operations from the decorator to the underlying file, minimizing the need to manually override each file method.\nClass: FileWithLogging The FileWithLogging class is a decorator for file objects, allowing additional operations (like logging) to be performed whenever certain methods (e.g., writelines) are called on the file. It also ensures that all other file operations behave as if they were directly performed on the original file.\nclass FileWithLogging: def __init__(self, file): self.file = file def writelines(self, strings): self.file.writelines(strings) print(f'wrote {len(strings)} lines') def __iter__(self): return self.file.__iter__() def __next__(self): return self.file.__next__() def __getattr__(self, item): return getattr(self.__dict__['file'], item) def __setattr__(self, key, value): if key == 'file': self.__dict__[key] = value else: setattr(self.__dict__['file'], key) def __delattr__(self, item): delattr(self.__dict__['file'], item) Constructor: init(self, file): Initialize the decorator with the file to be wrapped. Method: writelines(self, strings): Write multiple lines to the file and log how many lines were written. Method: iter(self): Allow the decorated file to be used in a loop, forwarding iteration to the original file. Method: next(self): Support fetching the next line in a loop, just like the original Method: getattr(self, item): Forward all method and attribute calls to the original file, ensuring the decorator acts just like the file. Method: setattr(self, key, value): Set attributes either on the decorator or the original file, depending on the key. Method: delattr(self, item): Delete attributes from the original file.\nExample Usage: file = FileWithLogging(open('hello.txt', 'w')) file.writelines(['hello', 'world']) # Logs: wrote 2 lines file.write('testing') file.close() The FileWithLogging class decorates a file to add logging and ensure it retains all original file behaviors. It demonstrates how to wrap an object and dynamically forward calls, making it an effective example of enhancing functionality without modifying the original class.\n","wordCount":"1407","inLanguage":"en","image":"https://raghu-vijaykumar.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-08-26T00:01:00+05:30","dateModified":"2024-08-26T00:01:00+05:30","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/decorator/readme/"},"publisher":{"@type":"Organization","name":"Raghu Vijaykumar","logo":{"@type":"ImageObject","url":"https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://raghu-vijaykumar.github.io/blog/ accesskey=h title="Raghu Vijaykumar (Alt + H)"><img src=https://raghu-vijaykumar.github.io/apple-touch-icon.png alt aria-label=logo height=35>Raghu Vijaykumar</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://raghu-vijaykumar.github.io/blog/about/ title=about><span>about</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/docs/ title=docs><span>docs</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/posts/ title=posts><span>posts</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/sponsor/ title=sponsor><span>sponsor</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://raghu-vijaykumar.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://raghu-vijaykumar.github.io/blog/docs/>Docs</a></div><h1 class="post-title entry-hint-parent">Decorator Pattern</h1><div class=post-meta><span title='2024-08-26 00:01:00 +0530 +0530'>August 26, 2024</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1407 words&nbsp;·&nbsp;Me</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#motivation>Motivation</a></li><li><a href=#implementation>Implementation</a><ul><li><a href=#python-specific-implementation>Python-Specific Implementation</a></li><li><a href=#key-points>Key Points</a></li></ul></li><li><a href=#classic-implementation-of-decorator-pattern-in-object-oriented-programming>Classic Implementation of Decorator Pattern in Object-Oriented Programming</a><ul><li><a href=#motivation-1>Motivation</a></li><li><a href=#implementation-1>Implementation</a></li><li><a href=#explanation-1>Explanation</a></li><li><a href=#key-points-1>Key Points</a></li><li><a href=#limitations>Limitations</a></li></ul></li><li><a href=#file-decorator-implementation-with-logging>File Decorator Implementation with Logging</a><ul><li><a href=#class-filewithlogging>Class: FileWithLogging</a></li><li><a href=#example-usage>Example Usage:</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>The Decorator Pattern is a structural design pattern used to add additional behaviors or responsibilities to objects dynamically. Unlike subclassing, where additional functionality is achieved through inheritance, the decorator pattern allows the augmentation of an object’s behavior without modifying its structure or the need for inheritance. This promotes adherence to the Open/Closed Principle and Single Responsibility Principle in software design.</p><h2 id=motivation>Motivation<a hidden class=anchor aria-hidden=true href=#motivation>#</a></h2><p>The main motivation for using the decorator pattern is to add features or functionality to existing objects in a flexible and reusable way. Instead of altering the original object or creating numerous subclasses for every possible combination of features, decorators allow you to &ldquo;wrap&rdquo; an object with new functionality dynamically.</p><h2 id=implementation>Implementation<a hidden class=anchor aria-hidden=true href=#implementation>#</a></h2><p>General Approach</p><ul><li>Inheritance: One way to augment a class is by inheriting from it and adding new features. However, this approach can become cumbersome if multiple combinations of features are needed, leading to an explosion of subclasses.</li><li>Decorators: A more flexible approach is to use decorators, which are objects that wrap the original object and add new behaviors to it. Decorators can be stacked, allowing for dynamic and combinatorial behavior modification.</li></ul><h3 id=python-specific-implementation>Python-Specific Implementation<a hidden class=anchor aria-hidden=true href=#python-specific-implementation>#</a></h3><p>In Python, the decorator pattern can be implemented using higher-order functions, where a function wraps another function to extend its behavior. Python also provides special syntax for applying decorators to functions, using the @decorator_name syntax.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>time_it</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>start</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>  <span class=c1># Measure start time</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>func</span><span class=p>()</span>  <span class=c1># Call the original function</span>
</span></span><span class=line><span class=cl>        <span class=n>end</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>  <span class=c1># Measure end time</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>func</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s1> took </span><span class=si>{</span><span class=nb>int</span><span class=p>((</span><span class=n>end</span><span class=o>-</span><span class=n>start</span><span class=p>)</span><span class=o>*</span><span class=mi>1000</span><span class=p>)</span><span class=si>}</span><span class=s1>ms&#39;</span><span class=p>)</span>  <span class=c1># Print execution time</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>wrapper</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@time_it</span>  <span class=c1># Applying the time_it decorator</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>some_op</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Starting op&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># Simulate a time-consuming operation</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;We are done&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>123</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>some_op</span><span class=p>()</span>
</span></span></code></pre></div><h4 id=explanation>Explanation<a hidden class=anchor aria-hidden=true href=#explanation>#</a></h4><p><strong>Decorator Function (time_it)</strong>:</p><ul><li>Purpose: Measures the execution time of the function it decorates.</li><li>How It Works:<ul><li>It defines an inner function (wrapper) that wraps the original function.</li><li>The wrapper function records the start time, executes the original function, records the end time, and then prints the time taken to execute the function.</li><li>Finally, it returns the result of the original function.</li></ul></li></ul><p><strong>Decorated Function (some_op)</strong>:</p><ul><li>A simple function that simulates a time-consuming operation using time.sleep(1).</li><li>The @time_it decorator is applied to this function, meaning that every time some_op is called, it will be wrapped in the timing logic defined in time_it.</li></ul><p><strong>Execution</strong>:</p><ul><li>When some_op is called, the execution time is measured and printed due to the decorator, illustrating how the decorator pattern can be used to augment behavior without modifying the original function.</li></ul><h3 id=key-points>Key Points<a hidden class=anchor aria-hidden=true href=#key-points>#</a></h3><ul><li>Flexible Augmentation: Decorators allow the addition of functionality in a flexible manner without altering the original object or function.</li><li>Reusability: Decorators can be reused across different functions or objects, promoting code reusability.</li><li>Adherence to Design Principles: The decorator pattern supports the Open/Closed Principle by allowing the extension of an object&rsquo;s behavior without modifying its code.</li></ul><h2 id=classic-implementation-of-decorator-pattern-in-object-oriented-programming>Classic Implementation of Decorator Pattern in Object-Oriented Programming<a hidden class=anchor aria-hidden=true href=#classic-implementation-of-decorator-pattern-in-object-oriented-programming>#</a></h2><p>The Decorator Pattern is a structural design pattern used to dynamically add behavior to individual objects without affecting the behavior of other objects from the same class. This is achieved by creating decorator classes that wrap the original class, augmenting its functionality. This approach adheres to the Open/Closed Principle by allowing functionality to be extended without modifying existing code.</p><h3 id=motivation-1>Motivation<a hidden class=anchor aria-hidden=true href=#motivation-1>#</a></h3><p>In object-oriented programming, there often arises a need to extend the functionality of a class without modifying its code. Traditional inheritance can lead to an explosion of subclasses for every combination of features, making the system complex and hard to maintain. The decorator pattern offers a more flexible and reusable solution by allowing the dynamic composition of behaviors.</p><h3 id=implementation-1>Implementation<a hidden class=anchor aria-hidden=true href=#implementation-1>#</a></h3><p><strong>Core Components</strong>
Abstract Base Class (Shape):</p><ul><li>The abstract base class provides a common interface for all shapes, ensuring that concrete classes and decorators can be treated uniformly.
Concrete Classes (Circle, Square):</li><li>These classes represent the basic shapes. They implement the core functionality, such as resizing or defining specific properties like radius or side length.
Decorator Classes (ColoredShape, TransparentShape):</li><li>These classes are decorators that add additional functionality, such as color or transparency, to the basic shapes. They wrap a shape object and extend its behavior.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Shape</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Circle</span><span class=p>(</span><span class=n>Shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>radius</span><span class=o>=</span><span class=mf>0.0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>radius</span> <span class=o>=</span> <span class=n>radius</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>resize</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>factor</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>radius</span> <span class=o>*=</span> <span class=n>factor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s1>&#39;A circle of radius </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>radius</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Square</span><span class=p>(</span><span class=n>Shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>side</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>side</span> <span class=o>=</span> <span class=n>side</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s1>&#39;A square with side </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>side</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ColoredShape</span><span class=p>(</span><span class=n>Shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shape</span><span class=p>,</span> <span class=n>color</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>shape</span><span class=p>,</span> <span class=n>ColoredShape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s1>&#39;Cannot apply ColoredDecorator twice&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>shape</span> <span class=o>=</span> <span class=n>shape</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>color</span> <span class=o>=</span> <span class=n>color</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>shape</span><span class=si>}</span><span class=s1> has the color </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>color</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TransparentShape</span><span class=p>(</span><span class=n>Shape</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shape</span><span class=p>,</span> <span class=n>transparency</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>shape</span> <span class=o>=</span> <span class=n>shape</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>transparency</span> <span class=o>=</span> <span class=n>transparency</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>shape</span><span class=si>}</span><span class=s1> has </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>transparency</span> <span class=o>*</span> <span class=mf>100.0</span><span class=si>}</span><span class=s1>% transparency&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>circle</span> <span class=o>=</span> <span class=n>Circle</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>circle</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>red_circle</span> <span class=o>=</span> <span class=n>ColoredShape</span><span class=p>(</span><span class=n>circle</span><span class=p>,</span> <span class=s2>&#34;red&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>red_circle</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>red_half_transparent_square</span> <span class=o>=</span> <span class=n>TransparentShape</span><span class=p>(</span><span class=n>red_circle</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>red_half_transparent_square</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Example of double decoration</span>
</span></span><span class=line><span class=cl>    <span class=n>mixed</span> <span class=o>=</span> <span class=n>ColoredShape</span><span class=p>(</span><span class=n>ColoredShape</span><span class=p>(</span><span class=n>Circle</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span> <span class=s1>&#39;red&#39;</span><span class=p>),</span> <span class=s1>&#39;blue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>mixed</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=explanation-1>Explanation<a hidden class=anchor aria-hidden=true href=#explanation-1>#</a></h3><p><strong>Abstract Base Class (Shape)</strong>:</p><ul><li>Provides a base class for all shapes, enforcing a uniform interface. In this case, it only defines a <strong>str</strong> method, which is overridden by concrete shapes and decorators.
<strong>Concrete Shapes (Circle, Square)</strong>:</li></ul><p>These classes inherit from Shape and provide specific implementations for geometric shapes.</p><ul><li><p>Circle: Implements radius-related functionality and includes a resize method.</p></li><li><p>Square: Represents a square and stores the length of its side.
<strong>Decorator Classes (ColoredShape, TransparentShape)</strong>:</p></li><li><p>ColoredShape: Adds color to a shape. It checks if the shape has already been colored to prevent applying the same decorator twice.</p></li><li><p>TransparentShape: Adds transparency to a shape and converts the transparency value into a percentage for display.</p></li></ul><p><strong>Combining Decorators</strong>:</p><p>Decorators can be stacked, allowing for multiple extensions of the original shape&rsquo;s functionality. For example, a circle can be both colored and transparent.
The code demonstrates how to combine these decorators to create complex shapes with multiple features.</p><h3 id=key-points-1>Key Points<a hidden class=anchor aria-hidden=true href=#key-points-1>#</a></h3><ul><li>Dynamic Behavior Extension: The decorator pattern allows you to dynamically add functionality to objects at runtime, promoting flexibility and reusability.</li><li>Adherence to Design Principles: The pattern adheres to the Open/Closed Principle by allowing objects to be extended without modifying their code.</li><li>Preventing Redundant Decoration: The implementation includes checks to prevent the same decorator from being applied multiple times, avoiding redundant or conflicting behaviors.</li></ul><h3 id=limitations>Limitations<a hidden class=anchor aria-hidden=true href=#limitations>#</a></h3><ul><li>Access to Original Methods: Decorators do not automatically provide access to the original object&rsquo;s methods unless explicitly programmed. For example, the resize method of Circle is not accessible once the shape is decorated.</li><li>Complexity: When multiple decorators are stacked, it can become difficult to manage the interactions between them, particularly if they modify the same aspect of the object.</li></ul><h2 id=file-decorator-implementation-with-logging>File Decorator Implementation with Logging<a hidden class=anchor aria-hidden=true href=#file-decorator-implementation-with-logging>#</a></h2><p>This documentation outlines the implementation of a class decorator that wraps around a file object, allowing additional functionality such as logging while maintaining access to the file’s original methods. The approach leverages dynamic programming to proxy all operations from the decorator to the underlying file, minimizing the need to manually override each file method.</p><h3 id=class-filewithlogging>Class: FileWithLogging<a hidden class=anchor aria-hidden=true href=#class-filewithlogging>#</a></h3><p>The FileWithLogging class is a decorator for file objects, allowing additional operations (like logging) to be performed whenever certain methods (e.g., writelines) are called on the file. It also ensures that all other file operations behave as if they were directly performed on the original file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>FileWithLogging</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>file</span> <span class=o>=</span> <span class=n>file</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>writelines</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>strings</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>file</span><span class=o>.</span><span class=n>writelines</span><span class=p>(</span><span class=n>strings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;wrote </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>strings</span><span class=p>)</span><span class=si>}</span><span class=s1> lines&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__iter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>file</span><span class=o>.</span><span class=fm>__iter__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__next__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>file</span><span class=o>.</span><span class=fm>__next__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__getattr__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>],</span> <span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__setattr__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>key</span> <span class=o>==</span> <span class=s1>&#39;file&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nb>setattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>],</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__delattr__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>delattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>],</span> <span class=n>item</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Constructor: <strong>init</strong>(self, file)</strong>: Initialize the decorator with the file to be wrapped.
<strong>Method: writelines(self, strings)</strong>: Write multiple lines to the file and log how many lines were written.
<strong>Method: <strong>iter</strong>(self)</strong>: Allow the decorated file to be used in a loop, forwarding iteration to the original file.
<strong>Method: <strong>next</strong>(self)</strong>: Support fetching the next line in a loop, just like the original
<strong>Method: <strong>getattr</strong>(self, item)</strong>: Forward all method and attribute calls to the original file, ensuring the decorator acts just like the file.
<strong>Method: <strong>setattr</strong>(self, key, value)</strong>: Set attributes either on the decorator or the original file, depending on the key.
<strong>Method: <strong>delattr</strong>(self, item)</strong>: Delete attributes from the original file.</p><h3 id=example-usage>Example Usage:<a hidden class=anchor aria-hidden=true href=#example-usage>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>file</span> <span class=o>=</span> <span class=n>FileWithLogging</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=s1>&#39;hello.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>file</span><span class=o>.</span><span class=n>writelines</span><span class=p>([</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span> <span class=s1>&#39;world&#39;</span><span class=p>])</span>  <span class=c1># Logs: wrote 2 lines</span>
</span></span><span class=line><span class=cl><span class=n>file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s1>&#39;testing&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>file</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><p>The FileWithLogging class decorates a file to add logging and ensure it retains all original file behaviors. It demonstrates how to wrap an object and dynamically forward calls, making it an effective example of enhancing functionality without modifying the original class.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://raghu-vijaykumar.github.io/blog/tags/system-design/>System-Design</a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/software-architecture/>Software-Architecture</a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/patterns/>Patterns</a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/decorator/>Decorator</a></li></ul><nav class=paginav><a class=prev href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/composite/readme/><span class=title>« Prev</span><br><span>Composite Pattern</span>
</a><a class=next href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/readme/><span class=title>Next »</span><br><span>Design Patterns</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://raghu-vijaykumar.github.io/blog/>Raghu Vijaykumar</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>