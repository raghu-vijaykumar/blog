<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Singleton Pattern | Raghu Vijaykumar</title>
<meta name=keywords content="system-design,software-architecture,patterns,singleton"><meta name=description content="The singleton design pattern ensures that a class has only one instance and provides a global point of access to that instance. This pattern is often used when exactly one object is needed to coordinate actions across the system, such as when managing shared resources like databases or configuration settings.
Motivation The singleton pattern is motivated by scenarios where certain classes should only be instantiated once. Common examples include:
Database Connections: You typically only want one instance of a database connection throughout the lifecycle of an application to avoid redundant connections and ensure consistent access to the data."><meta name=author content="Me"><link rel=canonical href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/singleton/readme/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.e7c811b1152f0ea0017b0724f2c040700cf8bf84343fd4fd5eca45af82337db9.css integrity="sha256-58gRsRUvDqABewck8sBAcAz4v4Q0P9T9XspFr4Izfbk=" rel="preload stylesheet" as=style><link rel=icon href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/singleton/readme/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Singleton Pattern"><meta property="og:description" content="The singleton design pattern ensures that a class has only one instance and provides a global point of access to that instance. This pattern is often used when exactly one object is needed to coordinate actions across the system, such as when managing shared resources like databases or configuration settings.
Motivation The singleton pattern is motivated by scenarios where certain classes should only be instantiated once. Common examples include:
Database Connections: You typically only want one instance of a database connection throughout the lifecycle of an application to avoid redundant connections and ensure consistent access to the data."><meta property="og:type" content="article"><meta property="og:url" content="https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/singleton/readme/"><meta property="og:image" content="https://raghu-vijaykumar.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-08-26T00:01:00+05:30"><meta property="article:modified_time" content="2024-08-26T00:01:00+05:30"><meta property="og:site_name" content="Raghu Vijaykumar"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://raghu-vijaykumar.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Singleton Pattern"><meta name=twitter:description content="The singleton design pattern ensures that a class has only one instance and provides a global point of access to that instance. This pattern is often used when exactly one object is needed to coordinate actions across the system, such as when managing shared resources like databases or configuration settings.
Motivation The singleton pattern is motivated by scenarios where certain classes should only be instantiated once. Common examples include:
Database Connections: You typically only want one instance of a database connection throughout the lifecycle of an application to avoid redundant connections and ensure consistent access to the data."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Docs","item":"https://raghu-vijaykumar.github.io/blog/docs/"},{"@type":"ListItem","position":2,"name":"Singleton Pattern","item":"https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/singleton/readme/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Singleton Pattern","name":"Singleton Pattern","description":"The singleton design pattern ensures that a class has only one instance and provides a global point of access to that instance. This pattern is often used when exactly one object is needed to coordinate actions across the system, such as when managing shared resources like databases or configuration settings.\nMotivation The singleton pattern is motivated by scenarios where certain classes should only be instantiated once. Common examples include:\nDatabase Connections: You typically only want one instance of a database connection throughout the lifecycle of an application to avoid redundant connections and ensure consistent access to the data.","keywords":["system-design","software-architecture","patterns","singleton"],"articleBody":"The singleton design pattern ensures that a class has only one instance and provides a global point of access to that instance. This pattern is often used when exactly one object is needed to coordinate actions across the system, such as when managing shared resources like databases or configuration settings.\nMotivation The singleton pattern is motivated by scenarios where certain classes should only be instantiated once. Common examples include:\nDatabase Connections: You typically only want one instance of a database connection throughout the lifecycle of an application to avoid redundant connections and ensure consistent access to the data. Object Factories: An object factory is often stateless and doesn’t require multiple instances, making a singleton a natural choice. The pattern is often criticized because its improper use can lead to design issues, such as hidden dependencies and difficulties in testing. However, when used appropriately, it can be a powerful tool for managing global state.\nKey Concepts Single Instance: The singleton pattern restricts the instantiation of a class to one “single” instance.\nGlobal Access: Provides a global point of access to that instance. Lazy Instantiation: The singleton instance is created only when it is actually needed, rather than at the time of application startup. Example Implementation in Python import random class Database: initialized = False def __init__(self): # Initialization logic (e.g., loading a database) would go here. pass _instance = None def __new__(cls, *args, **kwargs): if not cls._instance: cls._instance = super(Database, cls).__new__(cls, *args, **kwargs) return cls._instance Usage # Creating the Singleton Instance database = Database() # Verifying Singleton Behavior if __name__ == '__main__': d1 = Database() d2 = Database() print(d1 == d2) # True, as both d1 and d2 refer to the same instance print(database == d1) # True, database and d1 refer to the same instance Overriding new: The new method is overridden to control the object allocation. If an instance already exists (_instance is not None), the existing instance is returned. If no instance exists, a new one is created and assigned to _instance. Initialization (init): The init method is called every time an instance is created or accessed. In a singleton, this can cause issues if initialization logic (e.g., loading resources) is placed here. To avoid repeated initialization, consider adding a guard clause to prevent the execution of initialization logic if the instance is already initialized. Potential Issues Repeated Initialization: Even though the singleton ensures that only one instance of the class exists, the init method might still be called multiple times. This can be problematic if init performs expensive operations, like loading a database. One way to handle this is by adding an initialization flag. Testing: Singletons can make unit testing challenging, as they introduce hidden dependencies. In testing, you may need to reset or mock the singleton instance to ensure tests are isolated from each other. Benefits of the Singleton Pattern Controlled Access: Ensures a class has only one instance, which is useful for resources like configuration settings or loggers. Global State: Provides a global point of access to the instance, making it easy to share the instance across different parts of the application. Singleton Using a Decorator A decorator can be used to implement the Singleton pattern by controlling the instantiation of a class and ensuring that only one instance of the class is ever created.\nCode Example:\ndef singleton(class_): instances = {} def get_instance(*args, **kwargs): if class_ not in instances: instances[class_] = class_(*args, **kwargs) return instances[class_] return get_instance @singleton class Database: def __init__(self): print('Loading database') if __name__ == '__main__': d1 = Database() d2 = Database() print(d1 == d2) # True, indicating that d1 and d2 are the same instance The singleton decorator keeps a dictionary of instances. When a class is instantiated, the decorator checks if an instance of the class already exists. If not, it creates one; otherwise, it returns the existing instance. The initializer is only called once, preventing multiple initializations. Singleton Using a Metaclass A metaclass can also be used to create a Singleton. The metaclass ensures that only one instance of the class is created, similar to the decorator approach.\nCode Example:\nclass Singleton(type): _instances = {} def __call__(cls, *args, **kwargs): if cls not in cls._instances: cls._instances[cls] = super(Singleton, cls).__call__(*args, **kwargs) return cls._instances[cls] class Database(metaclass=Singleton): def __init__(self): print('Loading database') if __name__ == '__main__': d1 = Database() d2 = Database() print(d1 == d2) # True, indicating that d1 and d2 are the same instance The Singleton metaclass overrides the call method, which is responsible for object creation. It checks if an instance of the class exists; if not, it creates one using the super() function. This approach is similar to the decorator but leverages Python’s metaclass capabilities. Monostate (Borg) Singleton Pattern The Monostate pattern is a variation of the Singleton pattern where all instances of the class share the same state. Unlike the traditional Singleton, it allows multiple instances but with shared state.\nCode Example:\nclass CEO: __shared_state = { 'name': 'Steve', 'age': 55 } def __init__(self): self.__dict__ = self.__shared_state def __str__(self): return f'{self.name} is {self.age} years old' class Monostate: _shared_state = {} def __new__(cls, *args, **kwargs): obj = super(Monostate, cls).__new__(cls, *args, **kwargs) obj.__dict__ = cls._shared_state return obj class CFO(Monostate): def __init__(self): self.name = '' self.money_managed = 0 def __str__(self): return f'{self.name} manages ${self.money_managed}bn' if __name__ == '__main__': ceo1 = CEO() print(ceo1) ceo1.age = 66 ceo2 = CEO() ceo2.age = 77 print(ceo1) print(ceo2) ceo2.name = 'Tim' ceo3 = CEO() print(ceo1, ceo2, ceo3) cfo1 = CFO() cfo1.name = 'Sheryl' cfo1.money_managed = 1 print(cfo1) cfo2 = CFO() cfo2.name = 'Ruth' cfo2.money_managed = 10 print(cfo1, cfo2, sep='\\n') In the Monostate pattern, the __shared_state or _shared_state dictionary is used to store the state of the class. Each instance shares the same state by setting self.dict to reference this shared state. Changes made through any instance will affect all other instances since they all reference the same state. Singleton Testing The Singleton pattern ensures that a class has only one instance and provides a global point of access to that instance. In this example, the Singleton is implemented using a metaclass.\nclass Singleton(type): _instances = {} def __call__(cls, *args, **kwargs): if cls not in cls._instances: cls._instances[cls] = super(Singleton, cls).__call__(*args, **kwargs) return cls._instances[cls] Here, the Singleton metaclass keeps a dictionary of instances, ensuring that only one instance of a class exists. If an instance already exists, it returns the existing instance instead of creating a new one.\nDatabase Class: The Database class uses the Singleton pattern to ensure that only one instance of the database is loaded into memory.\nclass Database(metaclass=Singleton): def __init__(self): self.population = {} f = open('capitals.txt', 'r') lines = f.readlines() for i in range(0, len(lines), 2): self.population[lines[i].strip()] = int(lines[i + 1].strip()) f.close() The Database class reads from a file named capitals.txt to load population data for various cities.\nSingleton Record Finder: The SingletonRecordFinder class uses the Database singleton to calculate the total population of a list of cities.\nclass SingletonRecordFinder: def total_population(self, cities): result = 0 for c in cities: result += Database().population[c] return result This approach tightly couples the record finder to the singleton database, which can make testing difficult.\nConfigurable Record Finder: To improve testability, the ConfigurableRecordFinder allows dependency injection, enabling the use of different databases for testing.\nclass ConfigurableRecordFinder: def __init__(self, db): self.db = db def total_population(self, cities): result = 0 for c in cities: result += self.db.population[c] return result This class takes a database object as an argument, making it possible to inject a dummy database during testing.\nDummy Database for Testing: The DummyDatabase class is a mock database used for unit testing.\nclass DummyDatabase: population = { 'alpha': 1, 'beta': 2, 'gamma': 3 } def get_population(self, name): return self.population[name] This class provides predictable, hardcoded population data to facilitate reliable testing.\nUnit Tests: The following unit tests ensure the Singleton behavior and verify the functionality of both the SingletonRecordFinder and ConfigurableRecordFinder.\nimport unittest class SingletonTests(unittest.TestCase): def test_is_singleton(self): db = Database() db2 = Database() self.assertEqual(db, db2) def test_singleton_total_population(self): \"\"\" This tests on a live database :( \"\"\" rf = SingletonRecordFinder() names = ['Seoul', 'Mexico City'] tp = rf.total_population(names) self.assertEqual(tp, 17500000 + 17400000) # what if these change? ddb = DummyDatabase() def test_dependent_total_population(self): crf = ConfigurableRecordFinder(self.ddb) self.assertEqual( crf.total_population(['alpha', 'beta']), 3 ) if __name__ == '__main__': unittest.main() test_is_singleton: Verifies that only one instance of the Database class exists. test_singleton_total_population: Tests the total population calculation using the SingletonRecordFinder with live data. test_dependent_total_population: Tests the total population calculation using the ConfigurableRecordFinder with a dummy database. These tests demonstrate the importance of decoupling code from singletons to allow for better testability.\n","wordCount":"1414","inLanguage":"en","image":"https://raghu-vijaykumar.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-08-26T00:01:00+05:30","dateModified":"2024-08-26T00:01:00+05:30","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/singleton/readme/"},"publisher":{"@type":"Organization","name":"Raghu Vijaykumar","logo":{"@type":"ImageObject","url":"https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://raghu-vijaykumar.github.io/blog/ accesskey=h title="Raghu Vijaykumar (Alt + H)"><img src=https://raghu-vijaykumar.github.io/apple-touch-icon.png alt aria-label=logo height=35>Raghu Vijaykumar</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://raghu-vijaykumar.github.io/blog/about/ title=about><span>about</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/docs/ title=docs><span>docs</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/posts/ title=posts><span>posts</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/sponsor/ title=sponsor><span>sponsor</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://raghu-vijaykumar.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://raghu-vijaykumar.github.io/blog/docs/>Docs</a></div><h1 class="post-title entry-hint-parent">Singleton Pattern</h1><div class=post-meta><span title='2024-08-26 00:01:00 +0530 +0530'>August 26, 2024</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1414 words&nbsp;·&nbsp;Me</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#motivation>Motivation</a></li><li><a href=#key-concepts>Key Concepts</a></li><li><a href=#example-implementation-in-python>Example Implementation in Python</a><ul><li><a href=#usage>Usage</a></li><li><a href=#potential-issues>Potential Issues</a></li></ul></li><li><a href=#benefits-of-the-singleton-pattern>Benefits of the Singleton Pattern</a></li><li><a href=#singleton-using-a-decorator>Singleton Using a Decorator</a></li><li><a href=#singleton-using-a-metaclass>Singleton Using a Metaclass</a></li><li><a href=#monostate-borg-singleton-pattern>Monostate (Borg) Singleton Pattern</a></li><li><a href=#singleton-testing>Singleton Testing</a></li></ul></nav></div></details></div><div class=post-content><p>The singleton design pattern ensures that a class has only one instance and provides a global point of access to that instance. This pattern is often used when exactly one object is needed to coordinate actions across the system, such as when managing shared resources like databases or configuration settings.</p><h2 id=motivation>Motivation<a hidden class=anchor aria-hidden=true href=#motivation>#</a></h2><p>The singleton pattern is motivated by scenarios where certain classes should only be instantiated once. Common examples include:</p><ul><li>Database Connections: You typically only want one instance of a database connection throughout the lifecycle of an application to avoid redundant connections and ensure consistent access to the data.</li><li>Object Factories: An object factory is often stateless and doesn&rsquo;t require multiple instances, making a singleton a natural choice.</li></ul><p>The pattern is often criticized because its improper use can lead to design issues, such as hidden dependencies and difficulties in testing. However, when used appropriately, it can be a powerful tool for managing global state.</p><h2 id=key-concepts>Key Concepts<a hidden class=anchor aria-hidden=true href=#key-concepts>#</a></h2><p>Single Instance: The singleton pattern restricts the instantiation of a class to one &ldquo;single&rdquo; instance.</p><ul><li>Global Access: Provides a global point of access to that instance.</li><li>Lazy Instantiation: The singleton instance is created only when it is actually needed, rather than at the time of application startup.</li></ul><h2 id=example-implementation-in-python>Example Implementation in Python<a hidden class=anchor aria-hidden=true href=#example-implementation-in-python>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Database</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>initialized</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Initialization logic (e.g., loading a database) would go here.</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>_instance</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_instance</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>cls</span><span class=o>.</span><span class=n>_instance</span> <span class=o>=</span> <span class=nb>super</span><span class=p>(</span><span class=n>Database</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_instance</span>
</span></span></code></pre></div><h3 id=usage>Usage<a hidden class=anchor aria-hidden=true href=#usage>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Creating the Singleton Instance</span>
</span></span><span class=line><span class=cl><span class=n>database</span> <span class=o>=</span> <span class=n>Database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Verifying Singleton Behavior</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>d1</span> <span class=o>=</span> <span class=n>Database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>d2</span> <span class=o>=</span> <span class=n>Database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>d1</span> <span class=o>==</span> <span class=n>d2</span><span class=p>)</span>  <span class=c1># True, as both d1 and d2 refer to the same instance</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>database</span> <span class=o>==</span> <span class=n>d1</span><span class=p>)</span>  <span class=c1># True, database and d1 refer to the same instance</span>
</span></span></code></pre></div><ul><li>Overriding <strong>new</strong>: The <strong>new</strong> method is overridden to control the object allocation. If an instance already exists (_instance is not None), the existing instance is returned. If no instance exists, a new one is created and assigned to _instance.</li><li>Initialization (<strong>init</strong>): The <strong>init</strong> method is called every time an instance is created or accessed. In a singleton, this can cause issues if initialization logic (e.g., loading resources) is placed here. To avoid repeated initialization, consider adding a guard clause to prevent the execution of initialization logic if the instance is already initialized.</li></ul><h3 id=potential-issues>Potential Issues<a hidden class=anchor aria-hidden=true href=#potential-issues>#</a></h3><ul><li>Repeated Initialization: Even though the singleton ensures that only one instance of the class exists, the <strong>init</strong> method might still be called multiple times. This can be problematic if <strong>init</strong> performs expensive operations, like loading a database. One way to handle this is by adding an initialization flag.</li><li>Testing: Singletons can make unit testing challenging, as they introduce hidden dependencies. In testing, you may need to reset or mock the singleton instance to ensure tests are isolated from each other.</li></ul><h2 id=benefits-of-the-singleton-pattern>Benefits of the Singleton Pattern<a hidden class=anchor aria-hidden=true href=#benefits-of-the-singleton-pattern>#</a></h2><ul><li>Controlled Access: Ensures a class has only one instance, which is useful for resources like configuration settings or loggers.</li><li>Global State: Provides a global point of access to the instance, making it easy to share the instance across different parts of the application.</li></ul><h2 id=singleton-using-a-decorator>Singleton Using a Decorator<a hidden class=anchor aria-hidden=true href=#singleton-using-a-decorator>#</a></h2><p>A decorator can be used to implement the Singleton pattern by controlling the instantiation of a class and ensuring that only one instance of the class is ever created.</p><p>Code Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>singleton</span><span class=p>(</span><span class=n>class_</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>instances</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_instance</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>class_</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>instances</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>instances</span><span class=p>[</span><span class=n>class_</span><span class=p>]</span> <span class=o>=</span> <span class=n>class_</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>instances</span><span class=p>[</span><span class=n>class_</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>get_instance</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@singleton</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Database</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Loading database&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>d1</span> <span class=o>=</span> <span class=n>Database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>d2</span> <span class=o>=</span> <span class=n>Database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>d1</span> <span class=o>==</span> <span class=n>d2</span><span class=p>)</span>  <span class=c1># True, indicating that d1 and d2 are the same instance</span>
</span></span></code></pre></div><ul><li>The singleton decorator keeps a dictionary of instances.</li><li>When a class is instantiated, the decorator checks if an instance of the class already exists. If not, it creates one; otherwise, it returns the existing instance.</li><li>The initializer is only called once, preventing multiple initializations.</li></ul><h2 id=singleton-using-a-metaclass>Singleton Using a Metaclass<a hidden class=anchor aria-hidden=true href=#singleton-using-a-metaclass>#</a></h2><p>A metaclass can also be used to create a Singleton. The metaclass ensures that only one instance of the class is created, similar to the decorator approach.</p><p>Code Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Singleton</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>_instances</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>cls</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_instances</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>cls</span><span class=o>.</span><span class=n>_instances</span><span class=p>[</span><span class=bp>cls</span><span class=p>]</span> <span class=o>=</span> <span class=nb>super</span><span class=p>(</span><span class=n>Singleton</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=fm>__call__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_instances</span><span class=p>[</span><span class=bp>cls</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Database</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>Singleton</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Loading database&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>d1</span> <span class=o>=</span> <span class=n>Database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>d2</span> <span class=o>=</span> <span class=n>Database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>d1</span> <span class=o>==</span> <span class=n>d2</span><span class=p>)</span>  <span class=c1># True, indicating that d1 and d2 are the same instance</span>
</span></span></code></pre></div><ul><li>The Singleton metaclass overrides the <strong>call</strong> method, which is responsible for object creation.</li><li>It checks if an instance of the class exists; if not, it creates one using the super() function.</li><li>This approach is similar to the decorator but leverages Python&rsquo;s metaclass capabilities.</li></ul><h2 id=monostate-borg-singleton-pattern>Monostate (Borg) Singleton Pattern<a hidden class=anchor aria-hidden=true href=#monostate-borg-singleton-pattern>#</a></h2><p>The Monostate pattern is a variation of the Singleton pattern where all instances of the class share the same state. Unlike the traditional Singleton, it allows multiple instances but with shared state.</p><p>Code Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>CEO</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>__shared_state</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;Steve&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;age&#39;</span><span class=p>:</span> <span class=mi>55</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__shared_state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s1> is </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span><span class=si>}</span><span class=s1> years old&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Monostate</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>_shared_state</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>obj</span> <span class=o>=</span> <span class=nb>super</span><span class=p>(</span><span class=n>Monostate</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>obj</span><span class=o>.</span><span class=vm>__dict__</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_shared_state</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>obj</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CFO</span><span class=p>(</span><span class=n>Monostate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>money_managed</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s1> manages $</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>money_managed</span><span class=si>}</span><span class=s1>bn&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>ceo1</span> <span class=o>=</span> <span class=n>CEO</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>ceo1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ceo1</span><span class=o>.</span><span class=n>age</span> <span class=o>=</span> <span class=mi>66</span>
</span></span><span class=line><span class=cl>    <span class=n>ceo2</span> <span class=o>=</span> <span class=n>CEO</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ceo2</span><span class=o>.</span><span class=n>age</span> <span class=o>=</span> <span class=mi>77</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>ceo1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>ceo2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ceo2</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;Tim&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>ceo3</span> <span class=o>=</span> <span class=n>CEO</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>ceo1</span><span class=p>,</span> <span class=n>ceo2</span><span class=p>,</span> <span class=n>ceo3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cfo1</span> <span class=o>=</span> <span class=n>CFO</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cfo1</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;Sheryl&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>cfo1</span><span class=o>.</span><span class=n>money_managed</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>cfo1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cfo2</span> <span class=o>=</span> <span class=n>CFO</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cfo2</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;Ruth&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>cfo2</span><span class=o>.</span><span class=n>money_managed</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>cfo1</span><span class=p>,</span> <span class=n>cfo2</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>In the Monostate pattern, the __shared_state or _shared_state dictionary is used to store the state of the class.</li><li>Each instance shares the same state by setting self.<strong>dict</strong> to reference this shared state.</li><li>Changes made through any instance will affect all other instances since they all reference the same state.</li></ul><h2 id=singleton-testing>Singleton Testing<a hidden class=anchor aria-hidden=true href=#singleton-testing>#</a></h2><p>The Singleton pattern ensures that a class has only one instance and provides a global point of access to that instance. In this example, the Singleton is implemented using a metaclass.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Singleton</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>_instances</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>cls</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_instances</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>cls</span><span class=o>.</span><span class=n>_instances</span><span class=p>[</span><span class=bp>cls</span><span class=p>]</span> <span class=o>=</span> <span class=nb>super</span><span class=p>(</span><span class=n>Singleton</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=fm>__call__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_instances</span><span class=p>[</span><span class=bp>cls</span><span class=p>]</span>
</span></span></code></pre></div><p>Here, the Singleton metaclass keeps a dictionary of instances, ensuring that only one instance of a class exists. If an instance already exists, it returns the existing instance instead of creating a new one.</p><p><strong>Database Class</strong>: The Database class uses the Singleton pattern to ensure that only one instance of the database is loaded into memory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Database</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>Singleton</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>population</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;capitals.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>lines</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>readlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>lines</span><span class=p>),</span> <span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>population</span><span class=p>[</span><span class=n>lines</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()]</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>lines</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><p>The Database class reads from a file named capitals.txt to load population data for various cities.</p><p><strong>Singleton Record Finder</strong>: The SingletonRecordFinder class uses the Database singleton to calculate the total population of a list of cities.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SingletonRecordFinder</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>total_population</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cities</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>cities</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>+=</span> <span class=n>Database</span><span class=p>()</span><span class=o>.</span><span class=n>population</span><span class=p>[</span><span class=n>c</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span></code></pre></div><p>This approach tightly couples the record finder to the singleton database, which can make testing difficult.</p><p><strong>Configurable Record Finder</strong>: To improve testability, the ConfigurableRecordFinder allows dependency injection, enabling the use of different databases for testing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>ConfigurableRecordFinder</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>db</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db</span> <span class=o>=</span> <span class=n>db</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>total_population</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cities</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>cities</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>+=</span> <span class=bp>self</span><span class=o>.</span><span class=n>db</span><span class=o>.</span><span class=n>population</span><span class=p>[</span><span class=n>c</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span></code></pre></div><p>This class takes a database object as an argument, making it possible to inject a dummy database during testing.</p><p><strong>Dummy Database for Testing</strong>: The DummyDatabase class is a mock database used for unit testing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>DummyDatabase</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>population</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;alpha&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;beta&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;gamma&#39;</span><span class=p>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_population</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>population</span><span class=p>[</span><span class=n>name</span><span class=p>]</span>
</span></span></code></pre></div><p>This class provides predictable, hardcoded population data to facilitate reliable testing.</p><p><strong>Unit Tests</strong>: The following unit tests ensure the Singleton behavior and verify the functionality of both the SingletonRecordFinder and ConfigurableRecordFinder.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>unittest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SingletonTests</span><span class=p>(</span><span class=n>unittest</span><span class=o>.</span><span class=n>TestCase</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_is_singleton</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>db</span> <span class=o>=</span> <span class=n>Database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>db2</span> <span class=o>=</span> <span class=n>Database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=n>db</span><span class=p>,</span> <span class=n>db2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_singleton_total_population</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34; This tests on a live database :( &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>rf</span> <span class=o>=</span> <span class=n>SingletonRecordFinder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>names</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Seoul&#39;</span><span class=p>,</span> <span class=s1>&#39;Mexico City&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>tp</span> <span class=o>=</span> <span class=n>rf</span><span class=o>.</span><span class=n>total_population</span><span class=p>(</span><span class=n>names</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=n>tp</span><span class=p>,</span> <span class=mi>17500000</span> <span class=o>+</span> <span class=mi>17400000</span><span class=p>)</span>  <span class=c1># what if these change?</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ddb</span> <span class=o>=</span> <span class=n>DummyDatabase</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_dependent_total_population</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>crf</span> <span class=o>=</span> <span class=n>ConfigurableRecordFinder</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ddb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>crf</span><span class=o>.</span><span class=n>total_population</span><span class=p>([</span><span class=s1>&#39;alpha&#39;</span><span class=p>,</span> <span class=s1>&#39;beta&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>unittest</span><span class=o>.</span><span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><ul><li>test_is_singleton: Verifies that only one instance of the Database class exists.</li><li>test_singleton_total_population: Tests the total population calculation using the SingletonRecordFinder with live data.</li><li>test_dependent_total_population: Tests the total population calculation using the ConfigurableRecordFinder with a dummy database.</li></ul><p>These tests demonstrate the importance of decoupling code from singletons to allow for better testability.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://raghu-vijaykumar.github.io/blog/tags/system-design/>System-Design</a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/software-architecture/>Software-Architecture</a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/patterns/>Patterns</a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/singleton/>Singleton</a></li></ul><nav class=paginav><a class=prev href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/proxy/readme/><span class=title>« Prev</span><br><span>Proxy Patterns</span>
</a><a class=next href=https://raghu-vijaykumar.github.io/blog/docs/system-design/solid-principles/readme/><span class=title>Next »</span><br><span>Solid Principles</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://raghu-vijaykumar.github.io/blog/>Raghu Vijaykumar</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>