<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Flyweight Pattern | Raghu Vijaykumar</title>
<meta name=keywords content="system-design,software-architecture,patterns,flyweight"><meta name=description content="Flyweight Design Pattern, a space optimization technique used to minimize memory consumption in scenarios where multiple objects share similar data. By externalizing and reusing common data, the Flyweight Pattern ensures that only a small number of objects are instantiated, reducing redundancy and optimizing resource usage.
Problem Statement The goal is to prevent redundant memory usage when storing common or repetitive data across multiple objects. For example, in a massively multiplayer online game or a text editor, many users may have similar names, and it would be inefficient to store identical or similar strings repeatedly."><meta name=author content="Me"><link rel=canonical href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/flyweight/readme/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.e7c811b1152f0ea0017b0724f2c040700cf8bf84343fd4fd5eca45af82337db9.css integrity="sha256-58gRsRUvDqABewck8sBAcAz4v4Q0P9T9XspFr4Izfbk=" rel="preload stylesheet" as=style><link rel=icon href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/flyweight/readme/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Flyweight Pattern"><meta property="og:description" content="Flyweight Design Pattern, a space optimization technique used to minimize memory consumption in scenarios where multiple objects share similar data. By externalizing and reusing common data, the Flyweight Pattern ensures that only a small number of objects are instantiated, reducing redundancy and optimizing resource usage.
Problem Statement The goal is to prevent redundant memory usage when storing common or repetitive data across multiple objects. For example, in a massively multiplayer online game or a text editor, many users may have similar names, and it would be inefficient to store identical or similar strings repeatedly."><meta property="og:type" content="article"><meta property="og:url" content="https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/flyweight/readme/"><meta property="og:image" content="https://raghu-vijaykumar.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-08-26T00:01:00+05:30"><meta property="article:modified_time" content="2024-08-26T00:01:00+05:30"><meta property="og:site_name" content="Raghu Vijaykumar"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://raghu-vijaykumar.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Flyweight Pattern"><meta name=twitter:description content="Flyweight Design Pattern, a space optimization technique used to minimize memory consumption in scenarios where multiple objects share similar data. By externalizing and reusing common data, the Flyweight Pattern ensures that only a small number of objects are instantiated, reducing redundancy and optimizing resource usage.
Problem Statement The goal is to prevent redundant memory usage when storing common or repetitive data across multiple objects. For example, in a massively multiplayer online game or a text editor, many users may have similar names, and it would be inefficient to store identical or similar strings repeatedly."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Docs","item":"https://raghu-vijaykumar.github.io/blog/docs/"},{"@type":"ListItem","position":2,"name":"Flyweight Pattern","item":"https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/flyweight/readme/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Flyweight Pattern","name":"Flyweight Pattern","description":"Flyweight Design Pattern, a space optimization technique used to minimize memory consumption in scenarios where multiple objects share similar data. By externalizing and reusing common data, the Flyweight Pattern ensures that only a small number of objects are instantiated, reducing redundancy and optimizing resource usage.\nProblem Statement The goal is to prevent redundant memory usage when storing common or repetitive data across multiple objects. For example, in a massively multiplayer online game or a text editor, many users may have similar names, and it would be inefficient to store identical or similar strings repeatedly.","keywords":["system-design","software-architecture","patterns","flyweight"],"articleBody":"Flyweight Design Pattern, a space optimization technique used to minimize memory consumption in scenarios where multiple objects share similar data. By externalizing and reusing common data, the Flyweight Pattern ensures that only a small number of objects are instantiated, reducing redundancy and optimizing resource usage.\nProblem Statement The goal is to prevent redundant memory usage when storing common or repetitive data across multiple objects. For example, in a massively multiplayer online game or a text editor, many users may have similar names, and it would be inefficient to store identical or similar strings repeatedly.\nTo address this, the Flyweight Pattern externalizes the common data and stores references to it, rather than storing the data directly in each object.\nExample Scenario Consider a system where 10,000 users are created, and each user has a first and last name. Without optimization, the system would store each full name as a unique string, resulting in significant memory overhead. Even though there are only 200 unique first and last names (100 first names and 100 last names), the traditional approach leads to the storage of 10,000 full names.\nThe Flyweight Pattern reduces memory usage by storing only 200 unique strings and referencing them via indices, rather than duplicating the full names for each user.\nImplementation The following implementation demonstrates the Flyweight Design Pattern using Python:\nUser Class (Inefficient Implementation): This class stores the full name of each user as a single string. Memory consumption increases with each new user, even if the first and last names are identical.\nclass User: def __init__(self, name): self.name = name User2 Class (Flyweight Implementation): This class optimizes memory usage by storing first and last names externally in a static list (strings) and referencing them via indices. When a user object is created, the first and last names are split, and their indices are stored instead of the actual strings.\nThe get_or_add function checks if the name is already stored. If it is, it returns the index; otherwise, it adds the name to the list and returns the new index. The str method reconstructs the full name by concatenating the indexed first and last names from the static list. class User2: strings = [] def __init__(self, full_name): def get_or_add(s): if s in self.strings: return self.strings.index(s) else: self.strings.append(s) return len(self.strings)-1 self.names = [get_or_add(x) for x in full_name.split(' ')] def __str__(self): return ' '.join([self.strings[x] for x in self.names]) Random Name Generation: A function random_string is used to generate random first and last names of length 8, simulating user names for the purpose of the experiment.\ndef random_string(): chars = string.ascii_lowercase return ''.join([random.choice(chars) for x in range(8)]) Main Program: The program creates 10,000 users using the inefficient User class and then optimizes memory usage by switching to the User2 class, which utilizes the Flyweight Pattern.\nif __name__ == '__main__': users = [] first_names = [random_string() for x in range(100)] last_names = [random_string() for x in range(100)] for first in first_names: for last in last_names: users.append(User(f'{first} {last}')) u2 = User2('Jim Jones') u3 = User2('Frank Jones') print(u2.names) print(u3.names) print(User2.strings) users2 = [] for first in first_names: for last in last_names: users2.append(User2(f'{first} {last}')) Benefits of Flyweight Pattern Memory Optimization: Instead of creating new strings for each user, the Flyweight Pattern reuses existing strings by referencing them via indices. This reduces memory consumption significantly. Efficient Storage: Only 200 unique strings are stored, regardless of the number of users. The full names are reconstructed dynamically when needed, saving memory and reducing overhead. Example Output The code first prints the indices corresponding to the first and last names for two users: ‘Jim Jones’ and ‘Frank Jones’. It also prints the shared static list of unique strings (User2.strings), which stores the first and last names. This approach demonstrates how the Flyweight Pattern effectively reduces redundant memory usage in scenarios with repetitive data. Text Formatting Example When formatting large amounts of text, such as capitalizing certain letters or words, allocating resources for each character in the text can become inefficient, especially when only a small subset of the text needs formatting.\nFor example, in a naive implementation, formatting operations (e.g., capitalizing letters) are applied using an array of boolean values to track whether each character in the text should be capitalized. This approach consumes unnecessary memory when formatting operations are sparse across large texts.\nThe Flyweight pattern offers an optimized solution by sharing the formatting information across text segments, reducing memory usage.\nNaive Approach FormattedText Class: A simple approach to formatting text, where a boolean array tracks which characters need to be capitalized.\nInitialization: Takes a string of plain text as input and creates an array of booleans (caps), initialized to False. Capitalization: Uses the capitalize() method to update the boolean array for characters within the specified range. String Representation: The str() method checks the boolean array when generating the final formatted string. class FormattedText: def __init__(self, plain_text): self.plain_text = plain_text self.caps = [False] * len(plain_text) def capitalize(self, start, end): for i in range(start, end): self.caps[i] = True def __str__(self): result = [] for i in range(len(self.plain_text)): c = self.plain_text[i] result.append(c.upper() if self.caps[i] else c) return ''.join(result) Example Usage: ft = FormattedText('This is a brave new world') ft.capitalize(10, 15) print(ft) Output:\nThis is a BRAVE new world Optimized Approach with Flyweight Pattern BetterFormattedText Class: Optimizes memory usage by applying formatting only to the specified ranges of text, using the Flyweight pattern.\nTextRange (Flyweight Class): Defines a range of text positions and tracks whether characters in the range should be capitalized, bold, italicized, etc. Flyweight Management: The get_range() method creates and returns TextRange objects that define formatting operations on specific segments of the text, which are then stored in a formatting list. String Representation: The __str__() method processes each character and checks if it falls within a TextRange that requires formatting. class BetterFormattedText: def __init__(self, plain_text): self.plain_text = plain_text self.formatting = [] class TextRange: def __init__(self, start, end, capitalize=False, bold=False, italic=False): self.start = start self.end = end self.capitalize = capitalize def covers(self, position): return self.start \u003c= position \u003c= self.end def get_range(self, start, end): range = self.TextRange(start, end) self.formatting.append(range) return range def __str__(self): result = [] for i in range(len(self.plain_text)): c = self.plain_text[i] for r in self.formatting: if r.covers(i) and r.capitalize: c = c.upper() result.append(c) return ''.join(result) Example Usage: bft = BetterFormattedText('This is a brave new world') bft.get_range(16, 19).capitalize = True print(bft) Output\nThis is a brave NEW world Key Differences Memory Usage: The naive approach FormattedText allocates a boolean array with the same length as the text, which can be inefficient for large texts with sparse formatting. The optimized approach BetterFormattedText only stores formatting data for specific ranges, reducing memory consumption. Flyweight Design: By utilizing TextRange objects, the Flyweight pattern ensures that formatting information is shared across text segments and not unnecessarily duplicated. ","wordCount":"1122","inLanguage":"en","image":"https://raghu-vijaykumar.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-08-26T00:01:00+05:30","dateModified":"2024-08-26T00:01:00+05:30","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/flyweight/readme/"},"publisher":{"@type":"Organization","name":"Raghu Vijaykumar","logo":{"@type":"ImageObject","url":"https://raghu-vijaykumar.github.io/blog/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://raghu-vijaykumar.github.io/blog/ accesskey=h title="Raghu Vijaykumar (Alt + H)"><img src=https://raghu-vijaykumar.github.io/apple-touch-icon.png alt aria-label=logo height=35>Raghu Vijaykumar</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://raghu-vijaykumar.github.io/blog/about/ title=about><span>about</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/docs/ title=docs><span>docs</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/posts/ title=posts><span>posts</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/sponsor/ title=sponsor><span>sponsor</span></a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://raghu-vijaykumar.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://raghu-vijaykumar.github.io/blog/docs/>Docs</a></div><h1 class="post-title entry-hint-parent">Flyweight Pattern</h1><div class=post-meta><span title='2024-08-26 00:01:00 +0530 +0530'>August 26, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1122 words&nbsp;·&nbsp;Me</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#problem-statement>Problem Statement</a></li><li><a href=#example-scenario>Example Scenario</a><ul><li><a href=#implementation>Implementation</a></li><li><a href=#benefits-of-flyweight-pattern>Benefits of Flyweight Pattern</a></li><li><a href=#example-output>Example Output</a></li></ul></li><li><a href=#text-formatting-example>Text Formatting Example</a><ul><li><a href=#naive-approach>Naive Approach</a></li><li><a href=#optimized-approach-with-flyweight-pattern>Optimized Approach with Flyweight Pattern</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Flyweight Design Pattern, a space optimization technique used to minimize memory consumption in scenarios where multiple objects share similar data. By externalizing and reusing common data, the Flyweight Pattern ensures that only a small number of objects are instantiated, reducing redundancy and optimizing resource usage.</p><h2 id=problem-statement>Problem Statement<a hidden class=anchor aria-hidden=true href=#problem-statement>#</a></h2><p>The goal is to prevent redundant memory usage when storing common or repetitive data across multiple objects. For example, in a massively multiplayer online game or a text editor, many users may have similar names, and it would be inefficient to store identical or similar strings repeatedly.</p><p>To address this, the Flyweight Pattern externalizes the common data and stores references to it, rather than storing the data directly in each object.</p><h2 id=example-scenario>Example Scenario<a hidden class=anchor aria-hidden=true href=#example-scenario>#</a></h2><p>Consider a system where 10,000 users are created, and each user has a first and last name. Without optimization, the system would store each full name as a unique string, resulting in significant memory overhead. Even though there are only 200 unique first and last names (100 first names and 100 last names), the traditional approach leads to the storage of 10,000 full names.</p><p>The Flyweight Pattern reduces memory usage by storing only 200 unique strings and referencing them via indices, rather than duplicating the full names for each user.</p><h3 id=implementation>Implementation<a hidden class=anchor aria-hidden=true href=#implementation>#</a></h3><p>The following implementation demonstrates the Flyweight Design Pattern using Python:</p><p><strong>User Class (Inefficient Implementation)</strong>:
This class stores the full name of each user as a single string.
Memory consumption increases with each new user, even if the first and last names are identical.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span></span></code></pre></div><p><strong>User2 Class (Flyweight Implementation)</strong>:
This class optimizes memory usage by storing first and last names externally in a static list (strings) and referencing them via indices.
When a user object is created, the first and last names are split, and their indices are stored instead of the actual strings.</p><ul><li>The get_or_add function checks if the name is already stored. If it is, it returns the index; otherwise, it adds the name to the list and returns the new index.</li><li>The <strong>str</strong> method reconstructs the full name by concatenating the indexed first and last names from the static list.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>User2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>strings</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>full_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>get_or_add</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>s</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>strings</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>strings</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>strings</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>strings</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>names</span> <span class=o>=</span> <span class=p>[</span><span class=n>get_or_add</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>full_name</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>strings</span><span class=p>[</span><span class=n>x</span><span class=p>]</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>names</span><span class=p>])</span>
</span></span></code></pre></div><p><strong>Random Name Generation</strong>:
A function random_string is used to generate random first and last names of length 8, simulating user names for the purpose of the experiment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>random_string</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>chars</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>chars</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>)])</span>
</span></span></code></pre></div><p><strong>Main Program</strong>:
The program creates 10,000 users using the inefficient User class and then optimizes memory usage by switching to the User2 class, which utilizes the Flyweight Pattern.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>users</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>first_names</span> <span class=o>=</span> <span class=p>[</span><span class=n>random_string</span><span class=p>()</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>last_names</span> <span class=o>=</span> <span class=p>[</span><span class=n>random_string</span><span class=p>()</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>first</span> <span class=ow>in</span> <span class=n>first_names</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>last</span> <span class=ow>in</span> <span class=n>last_names</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>users</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>User</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>first</span><span class=si>}</span><span class=s1> </span><span class=si>{</span><span class=n>last</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>u2</span> <span class=o>=</span> <span class=n>User2</span><span class=p>(</span><span class=s1>&#39;Jim Jones&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>u3</span> <span class=o>=</span> <span class=n>User2</span><span class=p>(</span><span class=s1>&#39;Frank Jones&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>u2</span><span class=o>.</span><span class=n>names</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>u3</span><span class=o>.</span><span class=n>names</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>User2</span><span class=o>.</span><span class=n>strings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>users2</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>first</span> <span class=ow>in</span> <span class=n>first_names</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>last</span> <span class=ow>in</span> <span class=n>last_names</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>users2</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>User2</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>first</span><span class=si>}</span><span class=s1> </span><span class=si>{</span><span class=n>last</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=benefits-of-flyweight-pattern>Benefits of Flyweight Pattern<a hidden class=anchor aria-hidden=true href=#benefits-of-flyweight-pattern>#</a></h3><ul><li><strong>Memory Optimization</strong>: Instead of creating new strings for each user, the Flyweight Pattern reuses existing strings by referencing them via indices. This reduces memory consumption significantly.</li><li><strong>Efficient Storage</strong>: Only 200 unique strings are stored, regardless of the number of users. The full names are reconstructed dynamically when needed, saving memory and reducing overhead.</li></ul><h3 id=example-output>Example Output<a hidden class=anchor aria-hidden=true href=#example-output>#</a></h3><ul><li>The code first prints the indices corresponding to the first and last names for two users: &lsquo;Jim Jones&rsquo; and &lsquo;Frank Jones&rsquo;.</li><li>It also prints the shared static list of unique strings (User2.strings), which stores the first and last names.
This approach demonstrates how the Flyweight Pattern effectively reduces redundant memory usage in scenarios with repetitive data.</li></ul><h2 id=text-formatting-example>Text Formatting Example<a hidden class=anchor aria-hidden=true href=#text-formatting-example>#</a></h2><p>When formatting large amounts of text, such as capitalizing certain letters or words, allocating resources for each character in the text can become inefficient, especially when only a small subset of the text needs formatting.</p><p>For example, in a naive implementation, formatting operations (e.g., capitalizing letters) are applied using an array of boolean values to track whether each character in the text should be capitalized. This approach consumes unnecessary memory when formatting operations are sparse across large texts.</p><p>The Flyweight pattern offers an optimized solution by sharing the formatting information across text segments, reducing memory usage.</p><h3 id=naive-approach>Naive Approach<a hidden class=anchor aria-hidden=true href=#naive-approach>#</a></h3><p><strong>FormattedText Class</strong>: A simple approach to formatting text, where a boolean array tracks which characters need to be capitalized.</p><ul><li>Initialization: Takes a string of plain text as input and creates an array of booleans (caps), initialized to False.</li><li>Capitalization: Uses the capitalize() method to update the boolean array for characters within the specified range.</li><li>String Representation: The <strong>str</strong>() method checks the boolean array when generating the final formatted string.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>FormattedText</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plain_text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>plain_text</span> <span class=o>=</span> <span class=n>plain_text</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>caps</span> <span class=o>=</span> <span class=p>[</span><span class=kc>False</span><span class=p>]</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>plain_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>capitalize</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>end</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>end</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>caps</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>plain_text</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>plain_text</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>caps</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=k>else</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=example-usage>Example Usage:<a hidden class=anchor aria-hidden=true href=#example-usage>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ft</span> <span class=o>=</span> <span class=n>FormattedText</span><span class=p>(</span><span class=s1>&#39;This is a brave new world&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ft</span><span class=o>.</span><span class=n>capitalize</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>ft</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Output:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>This is a BRAVE new world
</span></span></code></pre></div><h3 id=optimized-approach-with-flyweight-pattern>Optimized Approach with Flyweight Pattern<a hidden class=anchor aria-hidden=true href=#optimized-approach-with-flyweight-pattern>#</a></h3><p><strong>BetterFormattedText Class</strong>: Optimizes memory usage by applying formatting only to the specified ranges of text, using the Flyweight pattern.</p><ul><li><strong>TextRange (Flyweight Class)</strong>: Defines a range of text positions and tracks whether characters in the range should be capitalized, bold, italicized, etc.</li><li><strong>Flyweight Management</strong>: The <code>get_range()</code> method creates and returns TextRange objects that define formatting operations on specific segments of the text, which are then stored in a formatting list.</li><li><strong>String Representation</strong>: The <code>__str__()</code> method processes each character and checks if it falls within a TextRange that requires formatting.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>BetterFormattedText</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plain_text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>plain_text</span> <span class=o>=</span> <span class=n>plain_text</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>formatting</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>TextRange</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>end</span><span class=p>,</span> <span class=n>capitalize</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>bold</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>italic</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>start</span> <span class=o>=</span> <span class=n>start</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>end</span> <span class=o>=</span> <span class=n>end</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>capitalize</span> <span class=o>=</span> <span class=n>capitalize</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>covers</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>position</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>start</span> <span class=o>&lt;=</span> <span class=n>position</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_range</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>end</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>range</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>TextRange</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>end</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>formatting</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>range</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>range</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>plain_text</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>plain_text</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>formatting</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>covers</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=ow>and</span> <span class=n>r</span><span class=o>.</span><span class=n>capitalize</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>c</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=example-usage-1>Example Usage:<a hidden class=anchor aria-hidden=true href=#example-usage-1>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>bft</span> <span class=o>=</span> <span class=n>BetterFormattedText</span><span class=p>(</span><span class=s1>&#39;This is a brave new world&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>bft</span><span class=o>.</span><span class=n>get_range</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span> <span class=mi>19</span><span class=p>)</span><span class=o>.</span><span class=n>capitalize</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>bft</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Output</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>This is a brave NEW world
</span></span></code></pre></div><h4 id=key-differences>Key Differences<a hidden class=anchor aria-hidden=true href=#key-differences>#</a></h4><ul><li><strong>Memory Usage</strong>: The naive approach <code>FormattedText</code> allocates a boolean array with the same length as the text, which can be inefficient for large texts with sparse formatting. The optimized approach <code>BetterFormattedText</code> only stores formatting data for specific ranges, reducing memory consumption.</li><li><strong>Flyweight Design</strong>: By utilizing TextRange objects, the Flyweight pattern ensures that formatting information is shared across text segments and not unnecessarily duplicated.</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://raghu-vijaykumar.github.io/blog/tags/system-design/>System-Design</a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/software-architecture/>Software-Architecture</a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/patterns/>Patterns</a></li><li><a href=https://raghu-vijaykumar.github.io/blog/tags/flyweight/>Flyweight</a></li></ul><nav class=paginav><a class=prev href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/factory/readme/><span class=title>« Prev</span><br><span>Factory Pattern</span>
</a><a class=next href=https://raghu-vijaykumar.github.io/blog/docs/system-design/design-patterns/proxy/readme/><span class=title>Next »</span><br><span>Proxy Patterns</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://raghu-vijaykumar.github.io/blog/>Raghu Vijaykumar</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>